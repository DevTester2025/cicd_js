<app-cloudmatiq-side-nav>
  <ng-container class="page-body">
    <div nz-row>
      <div nz-col nzSpan="24" class="mt-3">
    <div *ngIf="type ==='GITHUB'" class="providerTitle">
      <div class="m-r-20">
      <svg width="58" height="58" viewBox="0 0 58 58" fill="none" xmlns="http://www.w3.org/2000/svg">
        <rect y="0.321655" width="58" height="57.3566" fill="white"/>
        <path d="M29.0028 4.32166C14.9956 4.31599 3.65048 15.6554 3.65048 29.6513C3.65048 40.7189 10.7476 50.1269 20.6313 53.582C21.9624 53.9162 21.7585 52.9703 21.7585 52.3246V47.9349C14.0724 48.8355 13.7608 43.7492 13.2454 42.8996C12.2032 41.1211 9.73935 40.6679 10.4757 39.8183C12.2259 38.9178 14.0101 40.0449 16.0774 43.0978C17.5727 45.3125 20.4897 44.9387 21.9681 44.5705C22.2909 43.2394 22.9819 42.05 23.9335 41.1267C15.9698 39.6994 12.6507 34.8396 12.6507 29.0623C12.6507 26.2586 13.5739 23.6814 15.3864 21.6027C14.231 18.176 15.494 15.242 15.664 14.8058C18.9548 14.5113 22.3759 17.1621 22.6421 17.3717C24.5112 16.8676 26.6466 16.6013 29.0368 16.6013C31.4384 16.6013 33.5794 16.8789 35.4655 17.3886C36.1056 16.9015 39.2774 14.6246 42.336 14.9021C42.5003 15.3383 43.7351 18.2043 42.6475 21.5857C44.4827 23.6701 45.4173 26.2699 45.4173 29.0793C45.4173 34.868 42.0755 39.7334 34.0892 41.1381C34.7732 41.8108 35.3163 42.6131 35.6869 43.498C36.0574 44.383 36.2479 45.333 36.2472 46.2924V52.6644C36.2925 53.1742 36.2472 53.6783 37.0968 53.6783C47.1278 50.2969 54.3495 40.8209 54.3495 29.657C54.3495 15.6554 42.9987 4.32166 29.0028 4.32166Z" fill="black"/>
        </svg>
      </div>
      <div class="info">
        <h3 class="white-text">Github</h3>
        <p class="text-light-gray">Code hosting platform for version control and collaboration</p>
      </div>
    </div>
    <nz-spin [nzSpinning]="loading" [nzSize]="'large'" nzTip="Loading...">
      <nz-tabset 
    [nzTabBarExtraContent]="extraTemplate" 
    [nzSelectedIndex]="tabIndex"
    (nzSelectChange)="tabChanged($event)" >
    <ng-template #extraTemplate>
      <div
            nz-col
            nzSpan="12"
            nzXs="24"
            nzSm="24"
            nzMd="24"
            nzLg="24"
            nzXl="24"
          >
            <button
            *ngIf="tabIndex == 0"
              id="createProvider"
              nz-button
              nzType="primary"
              style="float: right"
              (click)="createProvider()"
              [nzLoading]="isLoading"
              [disabled]="providerForm.get('syncrepository').value" 
              class="publish-button"
            >
              {{ isUpdate ? "Update" : "Save" }}
            </button>
            <button
              nz-button
              nzType="primary"
              class="discard"
              style="float: right; margin-right: 3px"
              (click)="discard()"
            >
            Cancel
            </button>
          </div>
</ng-template>
    <nz-tab nzTitle="Basic Info">
      <div
        nz-col
        nzSpan="16"
        style="margin: 15px"
        class="add-provider"
      >
        <form nz-form [formGroup]="providerForm">
          <ng-container *ngIf="type === 'GITHUB'">
          <nz-form-item>
            <nz-form-label style="text-align: left" nzSpan="6"
              >Name</nz-form-label
            >
            <nz-form-control [nzSpan]="18">
              <input nz-input formControlName="name" placeholder="Name"/>
              <br />
              <nz-form-explain
                *ngIf="
                  providerForm.get('name').dirty &&
                  providerForm.get('name').errors
                "
              >
                {{
                  providerForm.get("name").errors.required
                    ? "Provider Name is required "
                    : ""
                }}
                {{
                  providerForm.get("name").errors.minlength
                    ? "Minimum length is 3 characters "
                    : ""
                }}
                {{
                  providerForm.get("name").errors.maxlength
                    ? "Maximum length is 50 characters "
                    : ""
                }}
              </nz-form-explain>
            </nz-form-control>
          </nz-form-item>
          <nz-form-item>
            <nz-form-label style="text-align: left" nzSpan="6"
              >Username</nz-form-label
            >
            <nz-form-control [nzSpan]="18">
              <input nz-input formControlName="username" placeholder='Username'/>
              <br />
              <nz-form-explain
                *ngIf="
                  providerForm.get('username').dirty &&
                  providerForm.get('username').errors
                "
              >
                {{
                  providerForm.get("username").errors.required
                    ? "Username is required "
                    : ""
                }}
                {{
                  providerForm.get("username").errors.minlength
                    ? "Minimum length is 3 characters "
                    : ""
                }}
                {{
                  providerForm.get("username").errors.maxlength
                    ? "Maximum length is 45 characters "
                    : ""
                }}
              </nz-form-explain>
            </nz-form-control>
          </nz-form-item>
          <nz-form-item>
            <nz-form-label style="text-align: left" nzSpan="6"
              >Organization Name</nz-form-label
            >
            <nz-form-control [nzSpan]="18">
              <input nz-input formControlName="organizationname" placeholder="Organizationname" />
              <nz-form-explain
                *ngIf="
                  providerForm.get('organizationname').dirty &&
                  providerForm.get('organizationname').errors
                "
              >
                {{
                  providerForm.get("organizationname").errors.minlength
                    ? "Minimum length is 3 characters "
                    : ""
                }}
                {{
                  providerForm.get("organizationname").errors.maxlength
                    ? "Maximum length is 50 characters "
                    : ""
                }}
              </nz-form-explain>
            </nz-form-control>
          </nz-form-item>
          <nz-form-item>
            <nz-form-label style="text-align: left" nzSpan="6"
              >Access Token</nz-form-label
            >
            <nz-form-control [nzSpan]="18">
              <input nz-input formControlName="accesstoken" placeholder="Accesstoken" />
              <br />
              <small
                style="color: white"
                *ngIf="
                  !providerForm.get('accesstoken').valid &&
                  !providerForm.get('accesstoken').dirty
                "
                >Access token for github</small
              >
              <nz-form-explain
                *ngIf="
                  providerForm.get('accesstoken').dirty &&
                  providerForm.get('accesstoken').errors
                "
              >
                {{
                  providerForm.get("accesstoken").errors.required
                    ? "Accesstoken is required "
                    : ""
                }}
                {{
                  providerForm.get("accesstoken").errors.minlength
                    ? "Minimum length is 10 characters "
                    : ""
                }}
                {{
                  providerForm.get("accesstoken").errors.maxlength
                    ? "Maximum length is 200 characters "
                    : ""
                }}
              </nz-form-explain>
            </nz-form-control>
          </nz-form-item>
          <nz-form-item>
            <nz-form-label style="text-align: left" nzSpan="6"
              >URL</nz-form-label
            >
            <nz-form-control [nzSpan]="18">
              <input nz-input formControlName="url" placeholder="Url" />
              <br />
              <small
                style="color: white"
                *ngIf="
                  !providerForm.get('url').valid &&
                  !providerForm.get('url').dirty
                "
                >(For enterprise accounts)</small
              >
              <nz-form-explain
                *ngIf="
                  providerForm.get('url').dirty &&
                  providerForm.get('url').errors
                "
              >
                {{
                  providerForm.get("url").errors.required
                    ? "URL is required "
                    : ""
                }}
                {{
                  providerForm.get("url").errors.minlength
                    ? "Minimum length is 10 characters "
                    : ""
                }}
                {{
                  providerForm.get("url").errors.maxlength
                    ? "Maximum length is 500 characters "
                    : ""
                }}
                {{
                  providerForm.get("url").errors.pattern
                    ? "Enter a valid URL"
                    : ""
                }}
              </nz-form-explain>
            </nz-form-control>
          </nz-form-item>
          <nz-form-item>
            <nz-form-label style="text-align: left" nzSpan="6"
              >Description</nz-form-label
            >
            <nz-form-control [nzSpan]="18">
              <nz-input-group>
                <p-editor
                  formControlName="description"
                  [style]="{ height: '220px',
                  width: '95%'
                   }"
                ></p-editor>
              </nz-input-group>
              <nz-form-explain
                *ngIf="
                  providerForm.get('description').dirty &&
                  providerForm.get('description').errors
                "
              >
                {{
                  providerForm.get("description").errors.maxlength
                    ? "Maximum length is 500 characters "
                    : ""
                }}
              </nz-form-explain>
            </nz-form-control>
          </nz-form-item>
          <h3 class="node-title-color">CMDB Integrations</h3>
          <h3 nz-col nzSpan="24" class="solution-title mb-0">Incoming Resource</h3>
      <div nz-row>
        <div nz-col nzSpan="24">
          <table id="tableContent" class="width-100">
            <thead>
              <tr>
                <th class="width-50">Resource Type</th>
                <th class="width-50">Attributes</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>
                  <nz-form-item>
                    <nz-form-control>
                      <nz-select
                        formControlName="resourcetype"
                        nzPlaceHolder="Select Resource type"
                        nzShowSearch
                        nzAllowClear
                        (ngModelChange)="getResourceDetail($event,'input')"
                      >
                        <nz-option
                          *ngFor="let option of resourceTypesList"
                          [nzValue]="option.crn"
                          [nzLabel]="option.resource"
                        ></nz-option>
                      </nz-select>
                    </nz-form-control>
                  </nz-form-item>
                </td>
                <td>
                  <nz-form-item>
                    <nz-form-control>
                      <nz-select
                        formControlName="attributes"
                        nzPlaceHolder="Select Attributes"
                        nzShowSearch
                        nzMode="multiple"
                        nzAllowClear
                      >
                        <nz-option
                          *ngFor="let option of filteredColumns"
                          [nzValue]="option.fieldname"
                          [nzLabel]="option.fieldname"
                        ></nz-option>
                      </nz-select>
                    </nz-form-control>
                  </nz-form-item>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <h3 nz-col nzSpan="24" class="solution-title mb-0">Outgoing Resources</h3>
          <div nz-row>
            <div nz-col nzSpan="24" style="margin-bottom: 10px;">
              <table id="tableContent">
                <thead>
                  <tr>
                    <th class="width-50">Resource Type</th>
                    <th class="width-50">Attributes</th>
                    <th class="width-3">
                      <span style="float: right"
                        ><i
                          class="anticon anticon-plus yellow-icon"
                          (click)="addRow()"
                        ></i
                      ></span>
                    </th>
                  </tr>
                </thead>
                <tbody formArrayName="outgoingResources">
                  <tr
                    *ngFor="let t of outgoingResources.controls; let i = index"
                    [formGroupName]="i"
                  >
                    <td>
                      <nz-select
                        formControlName="outgoingResourcetype"
                        nzPlaceHolder="Select Resource type"
                        nzShowSearch
                        nzAllowClear
                        (ngModelChange)="getResourceDetail($event,'output', i)"
                      >
                        <nz-option
                          *ngFor="let option of resourceTypesList"
                          [nzValue]="option.crn"
                          [nzLabel]="option.resource"
                        ></nz-option>
                      </nz-select>
                    </td>
                    <td>
                      <nz-select
                        formControlName="outgoingattributes"
                        nzPlaceHolder="Select Attributes"
                        nzShowSearch
                        nzMode="multiple"
                        nzAllowClear
                      >
                        <nz-option
                          *ngFor="let option of filteredColumns"
                          [nzValue]="option.fieldname"
                          [nzLabel]="option.fieldname"
                        ></nz-option>
                      </nz-select>
                    </td>
                    <td>
                      <span class="right"
                        ><i
                          class="anticon anticon-delete yellow-icon p-t-12"
                          (click)="deleteRow(i)"
                        ></i
                      ></span>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          
          <nz-form-item class="mt-10" *ngIf="showSyncRepository">
            <nz-form-label style="text-align: left" nzSpan="6"
              >Sync Repository</nz-form-label
            >
            <nz-form-control [nzSpan]="18">
              <nz-switch formControlName="syncrepository"></nz-switch>
          </nz-form-control>
          </nz-form-item>
        </ng-container>
        </form>
      </div>
      <div nz-col nzSpan="6">
        <div *ngIf="providerForm.get('syncrepository').value" class="card-container">
          <div>
            <div nz-row>
              <div nz-col nzSpan="20">
            <h3 class="white-text">Repository</h3>
            </div>
            <div nz-col nzSpan="4">
              <button nz-button nzType="primary"
              style="float: right;"
              [nzLoading]="repoloading" 
              [disabled]="syncdisabled" 
              (click)="refresh()">
                <i class="anticon anticon-sync"></i>
              </button>
            </div>
            </div>
            <nz-divider class="repoline"></nz-divider>
          </div>
          <nz-spin class="repospin" [nzSpinning]="repoloading" [nzSize]="'large'" nzTip="Loading...">
          <div nz-row *ngFor="let repo of repositories">
            <div nz-col nzSpan="12">
              <p class="text-light-gray">{{ repo.reponame ? repo.reponame : "-" }}</p>
            </div>
            <div nz-col nzSpan="12">
              <p class="text-light-gray" style="text-align: right;">
                <span>
                  <svg width="12" height="14" viewBox="0 0 12 14" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M6.66651 8.3335C4.42651 8.3335 3.69318 9.2335 3.45318 9.82683C4.16651 10.1335 4.66651 10.8402 4.66651 11.6668C4.66651 12.1973 4.4558 12.706 4.08073 13.081C3.70565 13.4561 3.19695 13.6668 2.66651 13.6668C2.13608 13.6668 1.62737 13.4561 1.2523 13.081C0.877226 12.706 0.666512 12.1973 0.666512 11.6668C0.666512 10.7935 1.21985 10.0535 1.99985 9.78016V4.22016C1.6092 4.08309 1.27092 3.82778 1.03199 3.48969C0.793051 3.15159 0.665315 2.74749 0.666512 2.3335C0.666512 1.80306 0.877226 1.29436 1.2523 0.919283C1.62737 0.54421 2.13608 0.333496 2.66651 0.333496C3.19695 0.333496 3.70565 0.54421 4.08073 0.919283C4.4558 1.29436 4.66651 1.80306 4.66651 2.3335C4.66651 3.20683 4.11318 3.94683 3.33318 4.22016V7.74683C3.91985 7.3135 4.77318 7.00016 5.99985 7.00016C7.77985 7.00016 8.37318 6.10683 8.56651 5.5135C8.20179 5.36155 7.89011 5.10518 7.67067 4.77661C7.45123 4.44804 7.33381 4.06194 7.33318 3.66683C7.33318 3.1364 7.54389 2.62769 7.91897 2.25262C8.29404 1.87754 8.80275 1.66683 9.33318 1.66683C9.86361 1.66683 10.3723 1.87754 10.7474 2.25262C11.1225 2.62769 11.3332 3.1364 11.3332 3.66683C11.3332 4.56016 10.7465 5.3335 9.93985 5.5735C9.76651 6.52683 9.11985 8.3335 6.66651 8.3335ZM2.66651 11.0002C2.4897 11.0002 2.32013 11.0704 2.19511 11.1954C2.07008 11.3204 1.99985 11.49 1.99985 11.6668C1.99985 11.8436 2.07008 12.0132 2.19511 12.1382C2.32013 12.2633 2.4897 12.3335 2.66651 12.3335C2.84332 12.3335 3.01289 12.2633 3.13792 12.1382C3.26294 12.0132 3.33318 11.8436 3.33318 11.6668C3.33318 11.49 3.26294 11.3204 3.13792 11.1954C3.01289 11.0704 2.84332 11.0002 2.66651 11.0002ZM2.66651 1.66683C2.4897 1.66683 2.32013 1.73707 2.19511 1.86209C2.07008 1.98712 1.99985 2.15668 1.99985 2.3335C1.99985 2.51031 2.07008 2.67988 2.19511 2.8049C2.32013 2.92992 2.4897 3.00016 2.66651 3.00016C2.84332 3.00016 3.01289 2.92992 3.13792 2.8049C3.26294 2.67988 3.33318 2.51031 3.33318 2.3335C3.33318 2.15668 3.26294 1.98712 3.13792 1.86209C3.01289 1.73707 2.84332 1.66683 2.66651 1.66683ZM9.33318 3.00016C9.15637 3.00016 8.9868 3.0704 8.86177 3.19542C8.73675 3.32045 8.66651 3.49002 8.66651 3.66683C8.66651 3.84364 8.73675 4.01321 8.86177 4.13823C8.9868 4.26326 9.15637 4.3335 9.33318 4.3335C9.50999 4.3335 9.67956 4.26326 9.80458 4.13823C9.92961 4.01321 9.99985 3.84364 9.99985 3.66683C9.99985 3.49002 9.92961 3.32045 9.80458 3.19542C9.67956 3.0704 9.50999 3.00016 9.33318 3.00016Z" fill="#B3B3B3"/>
                  </svg>
                  </span>&nbsp;
                {{ repo.branches ? repo.branches : "-" }}
              </p>
            </div>
          </div>
          </nz-spin>        
        </div>
      </div>
    </nz-tab>
    <nz-tab nzTitle="Comments" *ngIf="id !== undefined && isComments">
      <app-comments
        *ngIf="tabIndex == 1"
        [resourceDetails]="providerObj"
        [resourceId]="this.providerObj.refid"
        [refType]="'comments'"
      ></app-comments>
    </nz-tab>
    <nz-tab nzTitle="Change Logs" *ngIf="id !== undefined && isChangelogs">
      <app-comments
        *ngIf="tabIndex == 2"
        [resourceDetails]="providerObj"
        [resourceId]="providerObj.refid"
        [refType]="'history'"
      ></app-comments>
    </nz-tab>
  </nz-tabset>
    </nz-spin>
  </div>
</div>   
  </ng-container>
</app-cloudmatiq-side-nav>